--- aver.py.orig	2025-01-21 00:00:00.000000000 +0000
+++ aver.py	2025-01-21 00:00:00.000000000 +0000
@@ -2370,7 +2370,7 @@
         return key, None
 
     def _validate_and_store_kv(
         self,
         key: str,
         kvtype: Optional[str],
@@ -2378,6 +2378,88 @@
         incident: Incident,
     ) -> None:
         """
+        DEPRECATED: Use _validate_and_store_kv_single or _validate_and_store_kv_multi instead.
+        
+        Validate and store a KV pair.
+        
+        If key is special (config-defined), validates based on config.
+        Otherwise stores with provided type hint (or as string if no hint).
+        Validation only happens on write, so old values remain searchable
+        if config changes.
+        
+        Args:
+            key: Field name
+            kvtype: Type hint from KVParser ($ for string, # for int, % for float, None for untyped)
+            value: Value to store
+            incident: Incident to store in
+        """
+        # For now, delegate to single-value behavior (backward compat)
+        self._validate_and_store_kv_single(key, kvtype, value, incident)
+
+    def _validate_and_store_kv_single(
+        self,
+        key: str,
+        kvtype: Optional[str],
+        value: Any,
+        incident: Incident,
+    ) -> None:
+        """
+        Validate and store a single-value KV pair (replaces existing values).
+        
+        Validates that we're not trying to replace a multi-value field.
+        If key is special (config-defined), validates based on config.
+        Otherwise stores with provided type hint (or as string if no hint).
+        
+        Args:
+            key: Field name
+            kvtype: Type hint from KVParser ($ for string, # for int, % for float, None for untyped)
+            value: Value to store
+            incident: Incident to store in
+            
+        Raises:
+            ValueError: If attempting to use single-value operator on existing multi-value field
+        """
+        # Check if field already has multiple values (non-special fields only)
+        field = self.project_config.get_special_field(key)
+        
+        if not field:  # Not a special field
+            # Check existing values
+            existing_values = None
+            if key in incident.kv_strings:
+                existing_values = incident.kv_strings[key]
+            elif key in incident.kv_integers:
+                existing_values = incident.kv_integers[key]
+            elif key in incident.kv_floats:
+                existing_values = incident.kv_floats[key]
+            
+            if existing_values and len(existing_values) > 1:
+                # Determine the type for the error message
+                if kvtype == KVParser.TYPE_STRING or kvtype is None:
+                    flag_hint = "--text-multi/--tm"
+                elif kvtype == KVParser.TYPE_INTEGER:
+                    flag_hint = "--number-multi/--nm"
+                elif kvtype == KVParser.TYPE_FLOAT:
+                    flag_hint = "--decimal-multi/--dm"
+                else:
+                    flag_hint = "--kmv (legacy)"
+                
+                raise ValueError(
+                    f"Cannot use single-value operator on multi-value field '{key}' "
+                    f"(current values: {existing_values}). Use {flag_hint} instead."
+                )
+        
+        # Proceed with validation and storage (replaces all existing values)
+        self._validate_and_store_kv_impl(key, kvtype, value, incident, replace=True)
+
+    def _validate_and_store_kv_multi(
+        self,
+        key: str,
+        kvtype: Optional[str],
+        value: Any,
+        incident: Incident,
+    ) -> None:
+        """
+        Validate and store a multi-value KV pair (appends to existing values).
+        
         Validate and store a KV pair.
         
         If key is special (config-defined), validates based on config.
@@ -2391,6 +2473,24 @@
             value: Value to store
             incident: Incident to store in
         """
+        # For multi-value, we append rather than replace
+        self._validate_and_store_kv_impl(key, kvtype, value, incident, replace=False)
+
+    def _validate_and_store_kv_impl(
+        self,
+        key: str,
+        kvtype: Optional[str],
+        value: Any,
+        incident: Incident,
+        replace: bool = True,
+    ) -> None:
+        """
+        Internal implementation for validating and storing KV pairs.
+        
+        Args:
+            key: Field name
+            kvtype: Type hint
+            value: Value to store
+            incident: Incident to store in
+            replace: If True, replace existing values; if False, append
+        """
         field = self.project_config.get_special_field(key)
         
         if not field:
@@ -2401,49 +2501,82 @@
             
             if field.field_type == "single":
                 is_valid, error = self.project_config.validate_field(key, value)
                 if not is_valid:
                     raise ValueError(error)
+            else:  # multi
+                # Validate each value
+                values_to_validate = [value] if not isinstance(value, list) else value
+                for v in values_to_validate:
+                    is_valid, error = self.project_config.validate_field(key, v)
+                    if not is_valid:
+                        raise ValueError(error)
             
             # Store with config-defined type
             if field.value_type == "string":
                 if field.field_type == "single":
                     incident.kv_strings[key] = [value]
                 else:  # multi
                     if not isinstance(value, list):
                         value = [value]
-                    incident.kv_strings[key] = value
+                    if replace or key not in incident.kv_strings:
+                        incident.kv_strings[key] = value
+                    else:
+                        incident.kv_strings[key].extend(value)
             elif field.value_type == "integer":
                 if field.field_type == "single":
                     incident.kv_integers[key] = [int(value)]
                 else:  # multi
                     if not isinstance(value, list):
                         value = [value]
-                    incident.kv_integers[key] = [int(v) for v in value]
+                    int_values = [int(v) for v in value]
+                    if replace or key not in incident.kv_integers:
+                        incident.kv_integers[key] = int_values
+                    else:
+                        incident.kv_integers[key].extend(int_values)
             elif field.value_type == "float":
                 if field.field_type == "single":
                     incident.kv_floats[key] = [float(value)]
                 else:  # multi
                     if not isinstance(value, list):
                         value = [value]
-                    incident.kv_floats[key] = [float(v) for v in value]
+                    float_values = [float(v) for v in value]
+                    if replace or key not in incident.kv_floats:
+                        incident.kv_floats[key] = float_values
+                    else:
+                        incident.kv_floats[key].extend(float_values)
         else:
             # Non-special field - use type hint
             if kvtype == KVParser.TYPE_STRING or kvtype is None:
                 # Default to string if no type hint
-                if isinstance(value, list):
-                    incident.kv_strings[key] = [str(v) for v in value]
+                if replace or key not in incident.kv_strings:
+                    if isinstance(value, list):
+                        incident.kv_strings[key] = [str(v) for v in value]
+                    else:
+                        incident.kv_strings[key] = [str(value)] if value is not None else []
                 else:
-                    incident.kv_strings[key] = [str(value)] if value is not None else []
+                    # Append
+                    if isinstance(value, list):
+                        incident.kv_strings[key].extend([str(v) for v in value])
+                    else:
+                        incident.kv_strings[key].append(str(value))
             elif kvtype == KVParser.TYPE_INTEGER:
-                if isinstance(value, list):
-                    incident.kv_integers[key] = [int(v) for v in value]
+                if replace or key not in incident.kv_integers:
+                    if isinstance(value, list):
+                        incident.kv_integers[key] = [int(v) for v in value]
+                    else:
+                        incident.kv_integers[key] = [int(value)] if value is not None else []
                 else:
-                    incident.kv_integers[key] = [int(value)] if value is not None else []
+                    if isinstance(value, list):
+                        incident.kv_integers[key].extend([int(v) for v in value])
+                    else:
+                        incident.kv_integers[key].append(int(value))
             elif kvtype == KVParser.TYPE_FLOAT:
-                if isinstance(value, list):
-                    incident.kv_floats[key] = [float(v) for v in value]
+                if replace or key not in incident.kv_floats:
+                    if isinstance(value, list):
+                        incident.kv_floats[key] = [float(v) for v in value]
+                    else:
+                        incident.kv_floats[key] = [float(value)] if value is not None else []
                 else:
-                    incident.kv_floats[key] = [float(value)] if value is not None else []
+                    if isinstance(value, list):
+                        incident.kv_floats[key].extend([float(v) for v in value])
+                    else:
+                        incident.kv_floats[key].append(float(value))
 
     def create_incident(
         self,
-        kv_list: List[str],
+        kv_single: List[str],
+        kv_multi: List[str],
         description: Optional[str] = None,
@@ -2483,17 +2616,32 @@
         
         Example:
             manager.create_incident(
-                kv_list=[
+                kv_single=[
                     "title$Database error",
                     "severity$high",
                     "status$open",
                 ],
+                kv_multi=[],
                 use_editor=True,
                 use_toml_editor=True,
             )
         """
-        # Parse and apply all KV updates from CLI (override template)
-        parsed_kv = KVParser.parse_kv_list(kv_list)
+        # Parse single and multi KV updates separately
+        parsed_single = KVParser.parse_kv_list(kv_single) if kv_single else []
+        parsed_multi = KVParser.parse_kv_list(kv_multi) if kv_multi else []
 
         while True:  # NEW: Validation retry loop
             try:
-                for key, kvtype, op, value in parsed_kv:
+                # Process single-value KV (replaces)
+                for key, kvtype, op, value in parsed_single:
+                    if op == '-':
+                        raise ValueError(f"Cannot use removal operator '-' when creating incident")
+                    self._validate_and_store_kv_single(key, kvtype, value, incident)
+                
+                # Process multi-value KV (appends)
+                for key, kvtype, op, value in parsed_multi:
                     if op == '-':
                         raise ValueError(f"Cannot use removal operator '-' when creating incident")
-                    self._validate_and_store_kv(key, kvtype, value, incident)
+                    self._validate_and_store_kv_multi(key, kvtype, value, incident)
                 
@@ -2753,7 +2901,8 @@
     def update_incident_info(
         self,
         incident_id: str,
-        kv_list: List[str],
+        kv_single: List[str],
+        kv_multi: List[str],
         description: Optional[str] = None,
@@ -2776,13 +2925,20 @@
         Example:
             manager.update_incident_info(
                 incident_id,
-                ["status$resolved", "assignees$alice"],
+                kv_single=["status$resolved"],
+                kv_multi=["assignees$alice"],
                 description="Fixed the issue"
             )
         """
-        # Parse and apply KV updates from command line
-        parsed_kv = KVParser.parse_kv_list(kv_list)
+        # Parse single and multi KV updates separately
+        parsed_single = KVParser.parse_kv_list(kv_single) if kv_single else []
+        parsed_multi = KVParser.parse_kv_list(kv_multi) if kv_multi else []
+        
         while True:  # NEW: Validation retry loop
             try:
-                for key, kvtype, op, value in parsed_kv:
+                # Process single-value KV (replaces)
+                for key, kvtype, op, value in parsed_single:
+                    if op == '-':
                         # Removal
                         if key in incident.kv_strings:
@@ -2797,9 +2953,22 @@
                     else:
                         # Update
                         updated_fields.append(f"Add {key}: {value}")
-                        self._validate_and_store_kv(key, kvtype, value, incident)    
+                        self._validate_and_store_kv_single(key, kvtype, value, incident)
+                
+                # Process multi-value KV (appends)
+                for key, kvtype, op, value in parsed_multi:
+                    if op == '-':
+                        # Removal for multi-value
+                        if key in incident.kv_strings:
+                            incident.kv_strings[key] = [v for v in incident.kv_strings[key] if v != value]
+                        if key in incident.kv_integers:
+                            incident.kv_integers[key] = [v for v in incident.kv_integers[key] if v != int(value)]
+                        if key in incident.kv_floats:
+                            incident.kv_floats[key] = [v for v in incident.kv_floats[key] if v != float(value)]
+                        updated_fields.append(f"Removed {key}: {value}")
+                    else:
+                        updated_fields.append(f"Add {key}: {value}")
+                        self._validate_and_store_kv_multi(key, kvtype, value, incident)
                         # updated_fields.append(key)
                 
@@ -3530,7 +3699,8 @@
-    def _build_kv_list(self, manager: IncidentManager, args) -> List[str]:
+    def _build_kv_list(self, manager: IncidentManager, args) -> tuple[List[str], List[str]]:
         """
         Build KV lists from special field arguments and generic KV options.
         
         Processes special fields defined in ProjectConfig, new intuitive options,
         and legacy --kv/--kmv arguments. Prevents mixing special keys with new-style options.
+        
+        Returns:
+            (kv_single_list, kv_multi_list) - Two separate lists for single and multi-value operations
         """
-        kv_list = []
+        kv_single = []
+        kv_multi = []
         special_fields = manager.project_config.get_special_fields()
@@ -3567,15 +3737,21 @@
                 else:
                     type_prefix = "$"
                 
+                # Route to single or multi based on field definition
+                target_list = kv_single if field_def.field_type == "single" else kv_multi
+                
                 # Handle single vs multi-value fields
-                if field_def.field_type == "single":
-                    kv_list.append(f"{field_name}{type_prefix}{value}")
+                if isinstance(value, list):
+                    for v in value:
+                        target_list.append(f"{field_name}{type_prefix}{v}")
                 else:
-                    # Multi-value: value could be a list
-                    if isinstance(value, list):
-                        for v in value:
-                            kv_list.append(f"{field_name}{type_prefix}{v}")
-                    else:
-                        kv_list.append(f"{field_name}{type_prefix}{value}")
+                    target_list.append(f"{field_name}{type_prefix}{value}")
         
         # Process new-style options (with key=value parsing)
         try:
+            # Single-value options
             if getattr(args, 'text', None):
-                kv_list.extend(self._parse_and_convert_kv(args.text, "$"))
+                kv_single.extend(self._parse_and_convert_kv(args.text, "$"))
             
             if getattr(args, 'number', None):
-                kv_list.extend(self._parse_and_convert_kv(args.number, "#"))
+                kv_single.extend(self._parse_and_convert_kv(args.number, "#"))
             
             if getattr(args, 'decimal', None):
-                kv_list.extend(self._parse_and_convert_kv(args.decimal, "%"))
+                kv_single.extend(self._parse_and_convert_kv(args.decimal, "%"))
             
+            # Multi-value options
             if getattr(args, 'text_multi', None):
-                kv_list.extend(self._parse_and_convert_kv(args.text_multi, "$"))
+                kv_multi.extend(self._parse_and_convert_kv(args.text_multi, "$"))
             
             if getattr(args, 'number_multi', None):
-                kv_list.extend(self._parse_and_convert_kv(args.number_multi, "#"))
+                kv_multi.extend(self._parse_and_convert_kv(args.number_multi, "#"))
             
             if getattr(args, 'decimal_multi', None):
-                kv_list.extend(self._parse_and_convert_kv(args.decimal_multi, "%"))
+                kv_multi.extend(self._parse_and_convert_kv(args.decimal_multi, "%"))
         
         except ValueError as e:
@@ -3604,11 +3780,11 @@
         
         # Add legacy single-value KV arguments
         if hasattr(args, 'kv_single') and args.kv_single:
-            kv_list.extend(args.kv_single)
+            kv_single.extend(args.kv_single)
         
         # Add legacy multi-value KV arguments
         if hasattr(args, 'kv_multi') and args.kv_multi:
-            kv_list.extend(args.kv_multi)
+            kv_multi.extend(args.kv_multi)
         
-        return kv_list
+        return kv_single, kv_multi
 
@@ -3800,7 +3976,8 @@
         identity_override = self._check_git_identity(args, manager)
         if identity_override:
             manager.set_user_override(identity_override["handle"], identity_override["email"])
         
         # Build KV list
-        kv_list = self._build_kv_list(manager, args)
+        kv_single, kv_multi = self._build_kv_list(manager, args)
+        
         has_description = args.description is not None
@@ -3822,7 +3999,8 @@
         try:
             record_id = manager.create_incident(
-                kv_list=kv_list,
+                kv_single=kv_single,
+                kv_multi=kv_multi,
                 description=args.description,
@@ -3900,7 +4078,8 @@
             manager.set_user_override(identity_override["handle"], identity_override["email"])
     
         # Build KV list from special fields and generic KV arguments
-        kv_list = self._build_kv_list(manager, args)
+        kv_single, kv_multi = self._build_kv_list(manager, args)
     
         has_description = True if (hasattr(args, 'description') and args.description is not None) else False
@@ -3913,7 +4092,7 @@
         # Validate metadata_only usage
         if metadata_only:
-            if not kv_list:
+            if not kv_single and not kv_multi:
                 print("Error: --metadata-only requires at least one metadata field to update", file=sys.stderr)
                 sys.exit(1)
             if has_description:
                 print("Error: --metadata-only cannot be used with --description", file=sys.stderr)
                 sys.exit(1)

-        if not kv_list and not (has_description or has_stdin or use_editor):
+        if not kv_single and not kv_multi and not (has_description or has_stdin or use_editor):
             print("Error: No fields to update", file=sys.stderr)
@@ -3924,7 +4103,8 @@
         try:
             result = manager.update_incident_info(
                 args.record_id,
-                kv_list=kv_list,
+                kv_single=kv_single,
+                kv_multi=kv_multi,
                 description=args.description if has_description else None,
@@ -3964,8 +4144,9 @@
 
         try:
             # Build KV list for note (uses new-style options)
-            kv_list = self._build_kv_list(manager, args)
+            kv_single, kv_multi = self._build_kv_list(manager, args)
             
+            # For notes, both single and multi go into kv_single parameter (legacy behavior)
+            combined_kv = kv_single + kv_multi
             note_id = manager.add_update(
@@ -3975,7 +4156,7 @@
                 use_editor=use_editor,
                 use_toml_editor=use_toml_editor,
-                kv_single=kv_list,
+                kv_single=combined_kv,
                 kv_multi=None,
                 template_id=template_id,
